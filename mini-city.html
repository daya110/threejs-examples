<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MiniCity</title>
  <style>
    body{
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>
  <script src="js/libs/three.min.js"></script>
  <script src="js/libs/orbitControls.js"></script>
  <script src="js/libs/stats.min.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/textures.js"></script>
  <script>
    var scene, camera
    var renderer
    var width, width
  
    width = window.innerWidth
    height = window.innerHeight

    scene = new THREE.Scene()
    camera = new THREE.PerspectiveCamera(45, width / height, 1, 5000)
    camera.position.set(300,300,300)
    camera.lookAt(scene.position)
    scene.add(camera)

    renderer = new THREE.WebGLRenderer({antialias:true})
    renderer.setSize(width, height)
    renderer.setClearColor(0x282828)
    document.body.appendChild(renderer.domElement)

    buildAuxSystem()
    buildLightSystem()
    buildbuilding()
    buildRoad()
    loop()
    onWindowResize()

    function buildRoad () {
      var road = new THREE.Object3D()
      var roadColor = 0xffffff
      var roadBorderOuterCoords = [
        [-160, 160], [160, 160], [160, -160], [-160, -160],
      ]
      var roadBorderOuterHoleCoords = [
        [-159, 159], [-159,-159],[159, -159], [159, 159]
      ]
      var roadBorderOuterShape = utils.makeShape(roadBorderOuterCoords, roadBorderOuterHoleCoords)
      var roadBorderOuterGeometry = utils.makeExtrudeGeometry(roadBorderOuterShape, 0.1)
      var roadBorderOuter = utils.makeMesh('phong', roadBorderOuterGeometry, roadColor)
      road.add(roadBorderOuter)

      var roadBorderInnerCoords = [
        [-131, 131], [-131,  -131], [ 131,  -131], [ 131, 131],
        [ 19 , 131], [ 19 , 99], [ 99, 99], [ 99,  -99],
        [-99,  -99], [-99, 99], [-19,  99 ], [-19,  131 ]
      ]
      var roadBorderInnerShape = utils.makeShape(roadBorderInnerCoords)
      var roadBorderInnnerGeometry = utils.makeExtrudeGeometry(roadBorderInnerShape, 0.1)
      var roadBoaderInnder = utils.makeMesh('phong', roadBorderInnnerGeometry, roadColor)
      roadBoaderInnder.rotation.y = Math.PI
      road.add(roadBoaderInnder)

      var roadLineGeometry = new THREE.CubeGeometry(20, 0.1, 2)
      roadLineGeometry.translate(20,0,0)
      var roadLine = utils.makeMesh('phong', roadLineGeometry, roadColor)
      var roadLines = new THREE.Object3D()
      for( var i =0; i < 9; i++){
          var roadLlineCopy = roadLine.clone()
          roadLlineCopy.translateX(i*30)
          roadLines.add(roadLlineCopy)
      }

      var roadLinesBottom = roadLines.clone()
      roadLinesBottom.position.z = 145
      roadLinesBottom.position.x = -140
      road.add(roadLinesBottom)

      var roadLinesTop = roadLinesBottom.clone()
      roadLinesTop.position.z = -145
      road.add(roadLinesTop)

      var roadLinesLeft = roadLines.clone()
      roadLinesLeft.rotation.y = 0.5 * Math.PI
      roadLinesLeft.position.x = -145
      roadLinesLeft.position.z = 140
      road.add(roadLinesLeft)

      var roadLinesRight = roadLinesLeft.clone()
      roadLinesRight.position.x = 145
      road.add(roadLinesRight)

      scene.add(road)
    }

    function buildbuilding () {
      var planeGeometry = new THREE.BoxGeometry(320,6,320)
      var planeMaterial = new THREE.MeshLambertMaterial({color: 0x6f5f6a})
      var plane = new THREE.Mesh(planeGeometry, planeMaterial)
      plane.position.y = -3
      scene.add(plane)


      addFense()
      addGreen()
      addTrees()
      addHospital()
      addLamps()

      function addLamps () {
        var lampCoords = [
          [-12.5, 12.5, 41], [-7.5, 12.5, 1], [-2.5, 12.5, 1], [2.5, 12.5, 1], [7.5, 12.5, 1], 
          [12.5, 12.5, 12], [12.5, 7.5, 2], [12.5, 2.5, 2], [12.5, -2.5, 2], [12.5, -7.5, 2], 
          [12.5, -12.5, 23], [7.5, -12.5, 3], [2.5, -12.5, 3], [-2.5, -12.5, 3], [-7.5, -12.5, 3],
          [-12.5, -12.5, 34], [-12.5, -7.5, 4], [-12.5, -2.5, 4], [-12.5, 2.5, 4], [-12.5, 7.5, 4],   
        ]
        
        for (var i = 0; i < lampCoords.length; i++) {
          var p = lampCoords[i]
          var x = p[0] * 10, 
              z = p[1] * 10, 
              r = p[2]
          switch (r) {
            case 1 : r = -0.5 * Math.PI
              break;
            case 12 : r = -0.25 * Math.PI
              break;
            case 2 : r = 0
              break;
            case 23 : r = 0.25 * Math.PI
              break;
            case 3 : r = 0.5 * Math.PI
              break;
            case 34 : r = 0.75 * Math.PI
              break;
            case 4 : r = Math.PI
              break;
            case 41: r = 1.25 * Math.PI
          } 
          var lamp = createLamp()
          lamp.rotation.y = r
          lamp.position.set(x,0,z)
          scene.add(lamp)
        }
      }

      function addHospital () {
        var hospital = createHospital()
        hospital.position.z = -20
        scene.add(hospital)  
      }

      function addGreen () {
        var greenCoords = [
          [-120, -120], [-120,  120], [ 120,  120], [ 120, -120],
          [ 20 , -120], [ 20 , -100], [ 100, -100], [ 100,  100],
          [-100,  100], [-100, -100], [-20,  -100 ], [-20,  -120 ],
          [-120, -120]
        ]
        var greenShape = utils.makeShape(greenCoords)

        var greenGeometry = utils.makeExtrudeGeometry(greenShape, 3)
        var green = utils.makeMesh('lambert', greenGeometry, 0xc0c06a)
        scene.add(green)


      }

      function addFense () {
        var fenseCoords = [
          [-130, -130], [-130, 130], [ 130,  130], [ 130, -130],
          [ 20, -130], [ 20, -120], [ 120, -120], [ 120, 120],
          [-120, 120], [-120, -120], [-20,  -120 ], [-20,  -130 ],
          [-130, -130]
        ]
        var fenseShape = utils.makeShape(fenseCoords)
        
        var fenseGeometry = utils.makeExtrudeGeometry(fenseShape, 3)
        var fense = utils.makeMesh('lambert', fenseGeometry, 0xe5cabf)
        scene.add(fense)
      }
      
      function addTrees () {
        var treeCoords = [
          [-110, -110], [-90, -110],[-70, -110],[-50, -110],[-30, -110],[ -10, -110],[10, -110],[30, -110],[50, -110],[70, -110],[90, -110],
          [-110,  110], [-110, 90],[-110, 70],[-110, 50],[-110, 30],[ -110, 10],[-110, -10],[-110, -30],[-110, -50],[-110, -70],[-110, -90],
          [ 110,  110], [90, 110], [70, 110], [50, 110], [30, 110],[-30, 110], [-50, 110], [-70, 110], [-90, 110],
          [ 110, -110], [ 110, -90], [ 110, -70], [ 110, -50], [ 110, -30], [ 110, -10], [ 110, 10], [ 110, 30], [ 110, 50], [ 110, 70],  [ 110, 90],
        ]
        for (var i = 0; i < treeCoords.length; i++) {
          var treeX = treeCoords[i][0],
              treeY = 3,
              treeZ = treeCoords[i][1]
          var tree = createTree(treeCoords[i][0], 1, treeCoords[i][1])
          scene.add(tree)
        }
      }

      function createLamp () {
        var lamp = new THREE.Object3D()
        var pillarGeomertry = new THREE.CubeGeometry(2, 30, 2)
        pillarGeomertry.translate(0, 15, 0)
        var pillar = utils.makeMesh('phong', pillarGeomertry, 0xebd1c2)
        lamp.add(pillar)

        var connectGeometry = new THREE.CubeGeometry(10,1,1)
        var connect = utils.makeMesh('phong', connectGeometry, 0x2c0e0e)
        connect.position.set(3, 30, 0)
        lamp.add(connect)

        var lightGeometry = new THREE.CubeGeometry(6,2,4)
        light = utils.makeMesh('phong', lightGeometry, 0xebd1c2)
        light.position.set(10, 30, 0)
        lamp.add(light)

        return lamp
      }
      
      function createHospital () {
        var hospital = new THREE.Object3D()

        var baseGeometry = new THREE.BoxGeometry(180, 3, 140)
        var base = utils.makeMesh('lambert', baseGeometry, 0xffffff)
        base.position.y = 1
        hospital.add(base)

        var frontMainCoords = [
          [-80, -30], [-80, 20], [50, 20], [50, 0], [20, -30], [-80, -30]
        ]
        var frontMainShape = utils.makeShape(frontMainCoords)
        var frontMainGeometry = utils.makeExtrudeGeometry(frontMainShape,100)
        var frontMainMaterial = new THREE.MeshPhongMaterial({map: textures.window()})
        frontMainMaterial.map.repeat.set(0.1, 0.08)
        var frontMain = new THREE.Mesh(frontMainGeometry, frontMainMaterial)
        hospital.add(frontMain)

        var frontTopShape = frontMainShape
        var frontTopGeometry = utils.makeExtrudeGeometry(frontTopShape, 5)
        var frontTop = utils.makeMesh('lambert', frontTopGeometry, 0xb1a7af)
        frontTop.position.y = 100
        hospital.add(frontTop)

        var frontRoofs = new THREE.Object3D()
        var frontRoofShelfCubeGeometryZ = new THREE.CubeGeometry(2, 2, 40)
        var frontRoofShelfCubeZ = utils.makeMesh('phong', frontRoofShelfCubeGeometryZ, 0xffffff)
        var frontRoofShelfCubeX = frontRoofShelfCubeZ.clone()
        frontRoofShelfCubeX.rotation.y = 0.5 * Math.PI
        frontRoofShelfCubeX.scale.set(1,1,1.6)
        frontRoofShelfCubeX.position.x = 27
        frontRoofShelfCubeX.position.z = -15
        var frontRoofShelfCubeY = frontRoofShelfCubeZ.clone()
        frontRoofShelfCubeY.scale.z = 0.4
        frontRoofShelfCubeY.position.z =-15
        frontRoofShelfCubeY.position.y = -3
        frontRoofShelfCubeY.rotation.x = 0.5 * Math.PI
        for (var i = 0; i < 12; i++) {
          var frontRoofShelfCube = frontRoofShelfCubeZ.clone()
          frontRoofShelfCube.translateX(i * 5)
          frontRoofs.add(frontRoofShelfCube)
        }
        for (var i = 0; i < 2; i++) {
          var frontRoofShelfCube = frontRoofShelfCubeX.clone()
          frontRoofShelfCube.translateX(-i * 30)
          frontRoofs.add(frontRoofShelfCube)
        }
        var frontRoofShelfCubeYPosition = [[0,0], [1,0], [0, 1], [1,1]]
        for (var i = 0; i < frontRoofShelfCubeYPosition.length; i++) {
          var p = frontRoofShelfCubeYPosition[i]
          var frontRoofShelfCube = frontRoofShelfCubeY.clone()
          frontRoofShelfCube.translateX(p[0] * 55)
          frontRoofShelfCube.translateY(p[1] * 30)
          frontRoofs.add(frontRoofShelfCube)
        }
        frontRoofs.position.set(-70, 115, 5)
        hospital.add(frontRoofs)

        var frontPlatGeometry = new THREE.BoxGeometry(150,3,90)
        var fronPlat = utils.makeMesh('lambert', frontPlatGeometry, 0x0792a5)
        fronPlat.position.set(-3,18,25)
        hospital.add(fronPlat)

        var frontPlatVerticalGeometry = new THREE.BoxGeometry(150, 15, 3)
        var frontPlatVertical = utils.makeMesh('phong', frontPlatVerticalGeometry, 0x0792a5)
        frontPlatVertical.position.set(-3, 27, 68.5)
        hospital.add(frontPlatVertical)

        var frontPlatVerticalWhiteGeometry = new THREE.BoxGeometry(150, 3, 3)
        var frontPlatVerticalWhite = utils.makeMesh('phong', frontPlatVerticalWhiteGeometry, 0xffffff)
        frontPlatVerticalWhite.position.set(-3, 36, 68.5)
        hospital.add(frontPlatVerticalWhite)

        var frontPlatPillarGeometry = new THREE.CylinderGeometry(2, 2, 15, 32)
        var frontPlatPillar = utils.makeMesh('lambert', frontPlatPillarGeometry, 0xffffff)
        frontPlatPillar.position.set(-60, 10, 55)
        hospital.add(frontPlatPillar)

        var frontPlatPillar2 = frontPlatPillar.clone()
        frontPlatPillar2.position.set(55, 10, 55)
        hospital.add(frontPlatPillar2)


        var frontBorderVerticles = new THREE.Object3D()
        var frontBorderVerticleGeometry = new THREE.BoxGeometry(4, 106, 4)
        var frontBorderVerticleMesh = utils.makeMesh('phong', frontBorderVerticleGeometry, 0xffffff)
        var frontBorderVerticle1 = frontBorderVerticleMesh.clone()
        frontBorderVerticle1.position.set(-80, 52, 30)
        frontBorderVerticles.add(frontBorderVerticle1)
        var frontBorderVerticle2 = frontBorderVerticleMesh.clone()
        frontBorderVerticle2.position.set(-80, 52, -20)
        frontBorderVerticles.add(frontBorderVerticle2)
        var frontBorderVerticle3 = frontBorderVerticleMesh.clone()
        frontBorderVerticle3.position.set(50, 52, -18)
        frontBorderVerticles.add(frontBorderVerticle3)
        hospital.add(frontBorderVerticles)

        var frontRoofCoords = [
          [-82, -32], [20, -32], [52,0],[52, 22],[-82,22],[-82,-32]
        ]
        var frontRoofHolePath = [
          [-78, -28], [20, -28], [48,0],[48, 18],[-78,18],[-78,-28]
        ]
        var frontRoofShape = utils.makeShape(frontRoofCoords, frontRoofHolePath)
        var frontRoofGeometry = utils.makeExtrudeGeometry(frontRoofShape, 8)
        var frontRoof = utils.makeMesh('phong', frontRoofGeometry, 0xffffff)
        frontRoof.position.y = 100
        hospital.add(frontRoof)


        var backMainCoords = [
          [-80, 20], [-80, 60], [80, 60], [80, 20], [-80, 20]
        ]
        var backMainHolePath = [
          [-78, 22], [78, 22], [78, 58], [-78, 58], [-78, 22]
        ]
        var backMainShape = utils.makeShape(backMainCoords, backMainHolePath)

        var backMainGeometry = utils.makeExtrudeGeometry(backMainShape, 90)
        var backMain = utils.makeMesh('lambert', backMainGeometry, 0xf2e21b)
        hospital.add(backMain)

        var backMiddleCoords = [
          [0, 0], [36, 0], [36, 70], [0,70],[0,0]
        ]
        var backMiddleHolePath = [
          [2,2], [34, 2], [34, 68], [2, 68], [2, 2]
        ]
        var backMiddleShape = utils.makeShape(backMiddleCoords, backMiddleHolePath)
        var backMiddkeGeometry = utils.makeExtrudeGeometry(backMiddleShape, 165)
        var backMiddle = utils.makeMesh('lambert', backMiddkeGeometry, 0xffffff)
        backMiddle.rotation.x = -0.5 * Math.PI
        backMiddle.rotation.z = -0.5 * Math.PI
        backMiddle.position.y = 86
        backMiddle.position.z = -58
        backMiddle.position.x = -78
        hospital.add(backMiddle)

        var backMiddleWindowGeometry = new THREE.PlaneGeometry(32,66,1,1)
        var backMiddleWindowMaterial = new THREE.MeshPhongMaterial({map: textures.window()})
        backMiddleWindowMaterial.map.repeat.set(2,6)

        var backMiddleWindow = new THREE.Mesh(backMiddleWindowGeometry, backMiddleWindowMaterial)
        backMiddleWindow.position.set(83, 51, -40)
        backMiddleWindow.rotation.y = 0.5 * Math.PI
        hospital.add(backMiddleWindow)

        var windowBackOrigin = createWindow()
        windowBackOrigin.scale.set(0.6,0.6,1)
        windowBackOrigin.rotation.y = Math.PI
        windowBackOrigin.position.set(65, 75, -61)

        for (var i = 0; i < 7; i++) {
          for (var j = 0; j < 4; j++) {
            var windowObj = windowBackOrigin.clone()
            windowObj.position.x -= i * 22
            windowObj.position.y -= j * 20
            hospital.add(windowObj)
          }
        }

        return hospital
      }

      function createWindow () {
        var windowObj = new THREE.Object3D()
        var glassGeometry = new THREE.PlaneGeometry(20, 20)
        var glass = utils.makeMesh('phong', glassGeometry, 0x6a5e74)
        windowObj.add(glass)

        var windowBorderGeometry = new THREE.CubeGeometry(22,2,2)
        var windowBorder = utils.makeMesh('phong', windowBorderGeometry, 0xffffff)

        var windowBorderTop = windowBorder.clone()
        windowBorderTop.position.y = 10
        windowObj.add(windowBorderTop)

        var windowBorderBottom = windowBorder.clone()
        windowBorderBottom.position.y = -10
        windowObj.add(windowBorderBottom)

        var windowBorderLeft = windowBorder.clone()
        windowBorderLeft.rotation.z = 0.5 * Math.PI
        windowBorderLeft.position.x = -10
        windowObj.add(windowBorderLeft)

        var windowBorderRight = windowBorderLeft.clone()
        windowBorderRight.position.x = 10
        windowObj.add(windowBorderRight)

        return windowObj
      }

      function createTree (x, y, z) {
        var x = x || 0
        var y = y || 0
        var z = z || 0

        var tree = new THREE.Object3D()
        
        var treeTrunkGeometry = new THREE.BoxGeometry(2,16,2)
        var treeTrunkMaterial = new THREE.MeshLambertMaterial({color: 0x8a613a})
        var treeTrunk = new THREE.Mesh(treeTrunkGeometry, treeTrunkMaterial)
        treeTrunk.position.y = 8
        tree.add(treeTrunk)

        var treeLeafsGeometry = new THREE.BoxGeometry(8, 8, 8)
        var treeLeafsMaterial = new THREE.MeshLambertMaterial({color: 0x9c9e5d})
        var treeLeafs = new THREE.Mesh(treeLeafsGeometry, treeLeafsMaterial)
        treeLeafs.position.y = 13
        tree.add( treeLeafs)

        tree.position.set(x, y, z)

        return tree
      }
    }
    
    function buildLightSystem () {
      var hemisphereLight = new THREE.HemisphereLight( 0xffffff, 1)
      scene.add( hemisphereLight)

      // var directionalLight = new THREE.DirectionalLight( 0xffffff, 0.01 );
      // directionalLight.position.set(0,100,0)
      // scene.add( directionalLight )

    }

    function buildAuxSystem () {
      var stats = new Stats()
      stats.setMode(0)
      stats.domElement.style.position = 'absolute'
      stats.domElement.style.left = '5px'
      stats.domElement.style.top = '5px'
      document.body.appendChild(stats.domElement)

      // var axisHelper = new THREE.AxesHelper(200)
      // scene.add(axisHelper)

      var gridHelper = new THREE.GridHelper(320, 30)
      scene.add(gridHelper)

      var controls = new THREE.OrbitControls(camera, renderer.domElement)
      controls.enableDamping = true 
      controls.dampingFactor = 0.25
      controls.rotateSpeed = 0.35
    }
    function loop () {
      renderer.render(scene, camera)
      requestAnimationFrame(loop)
    }
    function onWindowResize () {
      window.addEventListener('resize', function () {
        width = window.innerWidth
        height = window.innerHeight

        camera.aspect = width / height;
        camera.updateProjectionMatrix()

        renderer.setSize(width, height)
      })
    }



    function Car (color) {
      this.color = color || 0x2cbab2
      this.mesh = new THREE.Object3D()
      this.wheels = []
      
      var that = this
      addBody()
      addWindows()
      addLights()
      addWheels()

      function addWheels () {
        var wheelFrontLeft = createWheel()
        wheelFrontLeft.position.set(8, 3, -6)
        that.wheels.push(wheelFrontLeft)
        that.mesh.add(wheelFrontLeft)

        var wheelFrontRight = createWheel()
        wheelFrontRight.position.set(8, 3, 6)
        that.wheels.push(wheelFrontRight)
        that.mesh.add(wheelFrontRight)

        var wheelBackLeft = createWheel()
        wheelBackLeft.position.set(-8, 3, 6)
        that.wheels.push(wheelBackLeft)
        that.mesh.add(wheelBackLeft)

        var wheelBackRight = createWheel()
        wheelBackRight.position.set(-8, 3, -6)
        that.wheels.push(wheelBackRight)
        that.mesh.add(wheelBackRight)

        function createWheel () {
          var wheel = new THREE.Object3D()

          var wheelOuterGeometry = new THREE.CylinderGeometry( 3, 3, 3, 32)
          wheelOuterGeometry.rotateX(0.5*Math.PI)
          var wheelOuter = utils.makeMesh('lambert', wheelOuterGeometry, 0x000000)
          wheel.add(wheelOuter)

          var wheelInner = utils.makeMesh('lambert', wheelOuterGeometry, 0xdddddd)
          wheelInner.scale.set(0.8,0.8,1.1)
          wheel.add(wheelInner)

          var wheelCenterGeometry = new THREE.CylinderGeometry( 1, 1, 3.6, 4)
          wheelCenterGeometry.rotateX(0.5*Math.PI)
          var wheelCenter = utils.makeMesh('lambert', wheelCenterGeometry, 0xa7a7a7)
          wheel.add(wheelCenter)

          return wheel
        }
      }

      function addLights () {
        var carLights = new THREE.Object3D() 

        var carLightGeometry = new THREE.CubeGeometry(2,2,2)
        var carLight = utils.makeMesh('phong', carLightGeometry, 0xffffff)

        var carLight1 = carLight.clone()
        carLight1.position.set(12.5, 7.1, 6.1)
        carLights.add(carLight1)

        var carLight2 = carLight.clone()
        carLight2.position.set(12.5, 7.1, -6.1)
        carLights.add(carLight2)

        var carLight3 = carLight.clone()
        carLight3.position.set(-12.5, 7.1, 6.1)
        carLights.add(carLight3)

        var carLight4 = carLight.clone()
        carLight4.position.set(-12.5, 7.1, -6.1)
        carLights.add(carLight4)

        var carLightFront = carLight.clone()
        carLightFront.scale.set(1,1.3,7.1)
        carLightFront.position.set(12.1, 3.3, 0)
        carLights.add(carLightFront)

        var carLightBack = carLightFront.clone()
        carLightBack.position.x = -14
        carLights.add(carLightBack)
        
        that.mesh.add(carLights)
      }
      
      function addWindows () {
        var carWindows = new THREE.Object3D()

        var carWindowLeft = new THREE.Object3D()
        var carWindowLeftFrontCoords = [
          [-2, 8], [4, 8], [2.5, 12], [-2, 12]
        ]
        var carWindowLeftFront = makeWindow(carWindowLeftFrontCoords)
        carWindowLeft.add(carWindowLeftFront)

        var carWindowLeftBackCoords = [
          [-9, 8], [-3, 8], [-3, 12], [-7.5, 12]
        ]
        var carWindowLeftBack = makeWindow(carWindowLeftBackCoords)
        carWindowLeft.add(carWindowLeftBack)
        carWindowLeft.position.z = 7.1
        carWindows.add(carWindowLeft)

        var carWindowRight = carWindowLeft.clone()
        carWindowRight.position.z = -7.1
        carWindows.add(carWindowRight)

        var carWindowFrontGeometry = new THREE.CubeGeometry(0.1, 5, 12)
        carWindowFrontGeometry.rotateZ(0.12 * Math.PI)
        carWindowFrontGeometry.translate(4.2,10,0)
        var carWindowFront = utils.makeMesh('phong',carWindowFrontGeometry, 0x000000)
        carWindows.add(carWindowFront)

        var carWindowBack = carWindowFront.clone()
        carWindowBack.rotation.z = -0.24 * Math.PI
        carWindowBack.position.x = -19
        carWindowBack.position.y = 6
        // carWindowFrontGeometry.translate(4.2,10,7)
        carWindows.add(carWindowBack)
        
        that.mesh.add(carWindows)
      }
      function addBody () {
        var carBodyCoords = [
          [-13,2], [13,2], [13,8], [5,8], [3,13], [-8,13], [-10,8], [-13,8], [-13,2]
        ]
        var carBodyShape = utils.makeShape(carBodyCoords)
        var carBodyGeometry = utils.makeExtrudeGeometry(carBodyShape, 14)
        carBodyGeometry.translate(0,-7,0)
        carBodyGeometry.rotateX(0.5 * Math.PI)
        var carBody = utils.makeMesh('phong', carBodyGeometry, that.color)
        that.mesh.add(carBody)
      }

      function makeWindow (coords) {
        var windowColor = 0x000000
        var shape = utils.makeShape(coords)
        var geometry = utils.makeExtrudeGeometry(shape, 0.1)
        geometry.rotateX(0.5 * Math.PI)
        var mesh = utils.makeMesh('phong', geometry, windowColor)
        return mesh
      }
    }
    Car.prototype = {
      setPosition: function (x,y,z) {
        this.mesh.position.set(x,y,z)
      },
      forward: function  (speed) {
        var speed = speed || 1
        this.mesh.position.x += 1 * speed
        for(var i = 0; i < this.wheels.length; i++){
          this.wheels[i].rotation.z -= 0.1*speed
        }
      },
      backward: function  (speed) {
        var speed = speed || 1
        this.mesh.position.x -= 1 * speed
        for(var i = 0; i < this.wheels.length; i++){
          this.wheels[i].rotation.z += 0.1*speed
        }
      },
      turnLeft: function (angle) {
        this.mesh.rotation.y += angle
      },
      turnRight: function (angle) {
        this.mesh.rotation.y += angle
      }
    }
    var car  = new Car()
    car.setPosition(0, 0, 145)
    scene.add(car.mesh)
    

  </script>
</body>
</html>